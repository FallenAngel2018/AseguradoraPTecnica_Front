@page
@model AseguradoraPTecnica_Front.Pages.Seguro.ContratarSegurosModel
@{
    ViewData["Title"] = "Seguros Contratados";
}


<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Seguros Contratados</h2>
    <button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#modalAsignarSeguro">
        <i class="bi bi-plus-lg"></i> Asignar Seguro
    </button>
</div>

<form id="formBuscarSeguro" method="post" class="mb-3">
    <div class="input-group">
        <input type="text" name="busqueda" class="form-control" placeholder="Ingrese cédula o código de seguro" aria-label="Buscar seguro o asegurado" />
        <div class="input-group-text">
            <input class="form-check-input mt-0" type="radio" name="tipoBusqueda" id="buscarPorCedula" value="cedula" checked />
            <label class="form-check-label ms-2" for="buscarPorCedula">Por cédula</label>
            <input class="form-check-input mt-0 ms-3" type="radio" name="tipoBusqueda" id="buscarPorCodigo" value="codigo" />
            <label class="form-check-label ms-2" for="buscarPorCodigo">Por código de seguro</label>
        </div>
        <button type="submit" class="btn btn-primary ms-3">Buscar</button>
    </div>
</form>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Cédula</th>
            <th>Nombres</th>
            <th>Seguro</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @if (!Model.SegurosContratados.Any())
        {
            <tr>
                <td colspan="5" class="text-center text-muted py-4">
                    <i class="bi bi-inbox"></i>
                    <p class="mb-0">No hay seguros contratados</p>
                    <small>Asigna un seguro para que aparezca aquí</small>
                </td>
            </tr>
        }
        else
        {
            foreach (var seguro in Model.SegurosContratados)
            {
                <tr>
                    <td>@seguro.Cedula</td>
                    <td>@seguro.Nombres</td>
                    <td>@seguro.NombreSeguro</td>
                    <td>
                        @if (seguro.Estado == 1)
                        {
                            <span class="badge bg-success">Activo</span>
                        }
                        else if (seguro.Estado == 0)
                        {
                            <span class="badge bg-danger">Inactivo</span>
                        }
                        else
                        {
                            <span class="badge bg-warning">Pendiente</span>
                        }
                    </td>
                    <td>
                        <button class="btn btn-warning btn-sm"
                                onclick="actualizarSeguro('@seguro.IdSeguroAsignado', '@seguro.CodSeguro')">
                            <i class="bi bi-pencil"></i> Actualizar
                        </button>
                        <button class="btn btn-danger btn-sm"
                                onclick="eliminarSeguro('@seguro.IdSeguroAsignado', '@seguro.CodSeguro')">
                            <i class="bi bi-trash"></i> Eliminar
                        </button>
                    </td>
                </tr>
            }
        }
    </tbody>

</table>

<!-- Modal Asignar Seguro -->
<div class="modal fade" id="modalAsignarSeguro" tabindex="-1" aria-labelledby="modalAsignarSeguroLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalAsignarSeguroLabel">Asignar Seguro a Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form id="formAsignarSeguro" method="post">
                    <div class="mb-3">
                        <label for="comboCliente" class="form-label">Cliente (Cédula y Nombre)</label>
                        <select id="comboCliente" name="CedulaCliente" class="form-select" data-live-search="true" aria-label="Seleccione un cliente">
                            <option value="">Seleccione un cliente</option>
                            @foreach (var cliente in Model.Clientes)
                            {
                                <option value="@cliente.Cedula">@cliente.Nombres @cliente.Apellidos (@cliente.Cedula)</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="comboSeguro" class="form-label">Seguro(s)</label>
                        <select id="comboSeguro" name="CodSeguros" multiple>
                            @foreach (var seguro in Model.Seguros)
                            {
                                <option value="@seguro.Codigo">@seguro.NombreSeguro</option>
                            }
                        </select>
                        <small class="form-text text-muted">Puede buscar y seleccionar uno o más seguros fácilmente.</small>
                    </div>

                    <div class="mb-3">
                        <label for="comboEstado" class="form-label">Estado</label>
                        <select id="comboEstado" name="Estado" class="form-select" aria-label="Seleccione estado">
                            @foreach (var estado in Model.Estados)
                            {
                                <option value="@estado.IdEstado">@estado.Estado</option>
                            }
                        </select>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="btnGuardarAsignacion">Guardar Asignación</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>


@section Scripts
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const combo = document.getElementById('comboSeguro');
            if (combo) {
                new Choices(combo, {
                    removeItemButton: true,
                    placeholder: true,
                    placeholderValue: 'Seleccione uno o más seguros',
                    searchPlaceholderValue: 'Buscar...',
                    shouldSort: false,
                    maxItemCount: 30
                });
            }
        });

        function actualizarSeguro(idSeguro, codSeguro) {
            // Puedes abrir modal y usar ambos IDs para buscar el detalle y editar
            alert('Actualizar seguro. IdAsignado: ' + idSeguro + ', Código: ' + codSeguro);
        }
        function eliminarSeguro(idSeguro, codSeguro) {
            if (confirm('¿Está seguro de eliminar el seguro?')) {
                // Puedes enviar ambos IDs al backend
                alert('Eliminar seguro. IdAsignado: ' + idSeguro + ', Código: ' + codSeguro);
            }
        }
    </script>
}

